<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Link Generator</title>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:#020617;padding:20px;border-radius:12px;max-width:420px;width:100%}
input,button{width:100%;padding:12px;border-radius:8px;border:0;margin-top:10px}
button{background:#38BFB3;color:#0F2F3A;font-weight:bold;cursor:pointer}
.small{font-size:12px;color:#94a3b8;margin-top:10px}
</style>
</head>
<body>
<div class="card">
  <h3>Generator Link</h3>
  <input id="repo" placeholder="Nama halaman (repo), contoh: ebook-emas"/>
  <input id="file" placeholder="Link file (direct download)"/>
  <input id="shop" placeholder="Link Shopee (affiliate)"/>
  <button onclick="generate()">GENERATE</button>
  <div id="out" class="small"></div>
</div>

<script>
const GITHUB_TOKEN = "PASTE_TOKEN_KAMU";          // ðŸ”’ simpan privat
const OWNER = "linkqita";                         // username GitHub kamu
const TEMPLATE = "template-engine";               // repo cetakan

async function generate(){
  const repo = document.getElementById('repo').value.trim();
  const file = document.getElementById('file').value.trim();
  const shop = document.getElementById('shop').value.trim();
  if(!repo||!file||!shop){ alert("Lengkapi semua field"); return; }

  const headers = { 
    "Authorization": "Bearer " + GITHUB_TOKEN,
    "Accept": "application/vnd.github+json"
  };

  // 1) Duplikat repo dari template
  const r1 = await fetch(`https://api.github.com/repos/${OWNER}/${TEMPLATE}/generate`,{
    method:"POST",
    headers: {...headers,"Content-Type":"application/json"},
    body: JSON.stringify({ name: repo, private: false })
  });
  if(!r1.ok){ document.getElementById('out').innerText="Gagal duplikat"; return; }

  // 2) Ambil index.html
  await new Promise(r=>setTimeout(r,1200));
  const r2 = await fetch(`https://api.github.com/repos/${OWNER}/${repo}/contents/index.html`,{ headers });
  const j2 = await r2.json();
  const content = atob(j2.content);

  // 3) Ganti variabel file & shopee & PAGE_ID
  const updated = content
    .replace(/const file\s*=\s*".*?";/,'const file = "'+file+'";')
    .replace(/const shopee\s*=\s*".*?";/,'const shopee = "'+shop+'";')
    .replace(/const PAGE_ID\s*=\s*".*?";/,'const PAGE_ID = "'+repo+'";');

  // 4) Commit kembali
  const r3 = await fetch(`https://api.github.com/repos/${OWNER}/${repo}/contents/index.html`,{
    method:"PUT",
    headers:{...headers,"Content-Type":"application/json"},
    body: JSON.stringify({
      message: "set links",
      content: btoa(updated),
      sha: j2.sha
    })
  });
  if(!r3.ok){ document.getElementById('out').innerText="Gagal update file"; return; }

  document.getElementById('out').innerText =
   "SUKSES! URL: https://"+OWNER+".github.io/"+repo+"/";
}
</script>
</body>
</html>
